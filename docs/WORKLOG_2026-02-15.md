# Work Log - 2026-02-15

## Summary
- Added GitHub collaboration baseline: PR template + Android CI build step.
- Fixed CI break caused by machine-specific Gradle Java home.
- Added README prerequisite notes for JDK 17.
- Completed major first-pass UI revisions across Scan/Results/Detail screens.
- Implemented real backend scan pipeline (Vision OCR + Gemini parsing + CSE image lookup).
- Wired Android app to backend scan API (multipart upload, processing states, error handling).
- Enabled development unlimited mode (paywall bypass) for faster testing.
- Added workaround so CSE image-search failures no longer block scan results.

## Detailed Work Completed
1. GitHub process setup
- Added `.github/PULL_REQUEST_TEMPLATE.md`.
- Updated `.github/workflows/android-quality.yml` to include `assembleDebug` in CI.

2. Build and environment stabilization
- Removed machine-specific `org.gradle.java.home` from `android/gradle.properties`.
- Added JDK 17 guidance and shell snippet to `README.md`.

3. Launcher icon and visual polish
- Regenerated launcher icons to remove excess whitespace around artwork.
- Updated icon assets under all mipmap density folders.

4. Scan screen UI redesign
- Removed "in Japan" from headline copy.
- Converted `MenuLens` from small chip to large top banner.
- Increased typography/card sizing and vertical balance.
- Centered major content distribution to reduce top-heavy layout.

5. Results screen UX changes
- Removed header chip usage from shared scaffold for all screens.
- Simplified Results copy.
- Removed price and "Show to staff" button on Results cards.
- Reordered cards to show English title first, Japanese below.
- Added "Tap the cards to show details of the dish."

6. Detail screen UX changes
- Removed unnecessary subtitle text and price on detail header/card.
- Reordered content: English title -> English short description -> Japanese text.
- Added two image placeholders for future real image rendering.
- Kept `Show to staff` CTA in detail view.

7. Backend real pipeline implementation
- Replaced backend stub in `backend/app/main.py` with real flow:
  - Google Vision OCR
  - Gemini structured extraction/translation/description
  - Google Custom Search image lookup (top 2 image URLs)
- Added env loading and required settings in `.env.example`.
- Added backend dependencies (`httpx`, `python-dotenv`).

8. Android real API integration
- Added Retrofit/Moshi DTO + service + repository:
  - `ScanApiModels.kt`
  - `ScanApiService.kt`
  - `ScanRepository.kt`
- Enabled internet/cleartext local testing in manifest.
- Added BuildConfig API base URL in Gradle and wired navigation flow:
  - Scan image bytes queued -> Processing -> backend call -> Results.
- Added Processing retry/back actions and surfaced scan error states.
- Increased HTTP timeouts for phone-based scan flow stability.

9. Development mode adjustments
- Added unlimited dev mode in `ResultsViewModel` (bypass paywall/credits).
- Added backend CSE workaround:
  - image search failures return empty images instead of failing full scan.
  - optional `ENABLE_IMAGE_SEARCH` flag support.

## Validation Performed
- Android compile checks passed multiple times:
  - `:app:compileDebugKotlin`
- Backend syntax check passed:
  - `python -m py_compile backend/app/main.py`
- Manual run verified:
  - FastAPI server startup
  - mobile app reaching backend
  - OCR/translation path returning results
  - CSE 403 handled via workaround

## Known Issues / Notes
- Google Custom Search still returning 403 in current account/project setup.
- Temporary behavior now: no images if CSE fails, text results still returned.
- Backend setup currently requires Python 3.12 (Python 3.14 caused pydantic-core install issue).
